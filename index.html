<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ÎšÎ±Ï„Î±Î³ÏÎ±Ï†Î® Î”Î¿Ï…Î»ÎµÎ¹ÏÎ½ + Î¥Î»Î¹ÎºÎ¬ & Î¦Î Î‘ (PWA)</title>
  <style>
    :root {
      --bg: #0f172a; --panel: #111827; --panel-2: #0b1220; --text: #e5e7eb; --muted: #9ca3af; --accent: #22d3ee; --accent-2: #a78bfa; --ok: #34d399; --warn: #fbbf24; --err: #f87171; --border: #1f2937;
    }
    * { box-sizing: border-box; }
    body { margin: 0; background: linear-gradient(120deg, var(--bg), #0b1022 60%, #0a0f1c); font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", Ubuntu, Cantarell, "Helvetica Neue", Arial; color: var(--text); }
    header { position: sticky; top: 0; backdrop-filter: blur(6px); background: rgba(15,23,42,.6); border-bottom: 1px solid var(--border); z-index: 5; }
    .container { max-width: 1200px; margin: 0 auto; padding: 16px; }
    h1 { font-size: clamp(20px,3vw,28px); margin: 8px 0 4px; }
    .sub { color: var(--muted); font-size: 13px; margin-bottom: 8px; }
    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 12px; }
    .card { background: linear-gradient(180deg, var(--panel), var(--panel-2)); border: 1px solid var(--border); border-radius: 14px; padding: 14px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    label { display: block; font-size: 12px; color: var(--muted); margin: 6px 0 6px 2px; }
    input, textarea, select { width: 100%; background: #0b1220; color: var(--text); border: 1px solid var(--border); border-radius: 10px; padding: 10px 12px; font-size: 14px; outline: none; transition: border-color .15s, box-shadow .15s; }
    input:focus, textarea:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(34,211,238,.15); }
    textarea { min-height: 70px; resize: vertical; }
    .row { display: grid; grid-template-columns: repeat(12, 1fr); gap: 12px; }
    .btns { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
    button { cursor: pointer; border: 1px solid var(--border); background: #0b1220; color: var(--text); padding: 10px 14px; border-radius: 999px; font-weight: 600; font-size: 14px; transition: transform .05s, background .15s; box-shadow: 0 4px 14px rgba(0,0,0,.25); }
    button:hover { background: #0f172a; } button:active { transform: translateY(1px); }
    .primary { background: linear-gradient(90deg, var(--accent), var(--accent-2)); border: none; color: #041016; }
    .ok { background: linear-gradient(90deg, var(--ok), #60a5fa); border: none; color: #05140a; }
    .warn { background: linear-gradient(90deg, var(--warn), #fb7185); border: none; color: #140b05; }
    .ghost { background: transparent; border: 1px dashed var(--border); }
    table { width: 100%; border-collapse: collapse; }
    th, td { border-bottom: 1px solid var(--border); padding: 8px 10px; font-size: 14px; text-align: left; vertical-align: top; }
    th { color: var(--muted); font-weight: 600; position: sticky; top: 0; background: #0c1322; z-index: 3; }
    tbody tr:hover { background: rgba(255,255,255,.02); }
    .pill { font-size: 12px; padding: 2px 8px; border-radius: 999px; border: 1px solid var(--border); color: var(--muted); }
    .sum { font-weight: 700; }
    .footer { color: var(--muted); font-size: 12px; text-align: center; padding: 20px 0 40px; }
    .right { text-align: right; }
    .nowrap { white-space: nowrap; }
    @media (max-width: 900px){ .grid, .row { grid-template-columns: repeat(6,1fr);} }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>ğŸ“’ ÎšÎ±Ï„Î±Î³ÏÎ±Ï†Î® Î”Î¿Ï…Î»ÎµÎ¹ÏÎ½ â€” Î¥Î»Î¹ÎºÎ¬ & Î¦Î Î‘ (Offline PWA)</h1>
      <div class="sub">ÎšÎ±Ï„Î±Ï‡ÏÏÎ¹ÏƒÎ· ÎµÏÎ³Î±ÏƒÎ¹ÏÎ½ Î¼Îµ Î±Î½Î±Î»Ï…Ï„Î¹ÎºÎ¬ Ï…Î»Î¹ÎºÎ¬, Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î¿ Î¦Î Î‘ (24% Î•Î»Î»Î¬Î´Î± â€” Ï€Î±ÏÎ±Î¼ÎµÏ„ÏÎ¿Ï€Î¿Î¹Î®ÏƒÎ¹Î¼Î¿), ÎµÎ¾Î±Î³Ï‰Î³Î® CSV, ÎµÎºÏ„ÏÏ€Ï‰ÏƒÎ·, Î±Î½Ï„Î¯Î³ÏÎ±Ï†Î±, ÎºÎ±Î¹ ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Ï‰Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®.</div>
    </div>
  </header>

  <main class="container" id="app">
    <!-- Î¦ÏŒÏÎ¼Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚ -->
    <section class="card">
      <div class="row">
        <div style="grid-column: span 3;">
          <label>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</label>
          <input type="date" id="date" />
        </div>
        <div style="grid-column: span 3;">
          <label>ÎÏÎµÏ‚ Î•ÏÎ³Î±ÏƒÎ¯Î±Ï‚</label>
          <input type="number" id="hours" step="0.1" min="0" placeholder="Ï€.Ï‡. 2.5" />
        </div>
        <div style="grid-column: span 6;">
          <label>Î ÎµÎ»Î¬Ï„Î·Ï‚</label>
          <input type="text" id="client" placeholder="ÎŒÎ½Î¿Î¼Î± Ï€ÎµÎ»Î¬Ï„Î·" />
        </div>
        <div style="grid-column: span 6;">
          <label>Î¤Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±</label>
          <input type="text" id="location" placeholder="Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Î® Ï€ÎµÏÎ¹Î¿Ï‡Î®" />
        </div>
        <div style="grid-column: span 6;">
          <label>Î•ÏÎ³Î±ÏƒÎ¯ÎµÏ‚ (Ï€ÎµÏÎ¹Î³ÏÎ±Ï†Î®)</label>
          <textarea id="task" placeholder="Î£ÏÎ½Ï„Î¿Î¼Î· Ï€ÎµÏÎ¹Î³ÏÎ±Ï†Î® ÎµÏÎ³Î±ÏƒÎ¹ÏÎ½..."></textarea>
        </div>

        <!-- Î¥Î»Î¹ÎºÎ¬: Î±Î½Î±Î»Ï…Ï„Î¹ÎºÎ­Ï‚ Î³ÏÎ±Î¼Î¼Î­Ï‚ -->
        <div style="grid-column: span 12;">
          <label>Î¥Î»Î¹ÎºÎ¬ (Î±Î½Î±Î»Ï…Ï„Î¹ÎºÎ¬)</label>
          <div style="overflow:auto; border:1px solid var(--border); border-radius:12px;">
            <table id="materialsTable">
              <thead>
                <tr>
                  <th style="width:32px">#</th>
                  <th>Î ÎµÏÎ¹Î³ÏÎ±Ï†Î®</th>
                  <th class="nowrap">Î Î¿ÏƒÏŒÏ„Î·Ï„Î±</th>
                  <th class="nowrap">ÎœÎ¿Î½Î¬Î´Î±</th>
                  <th class="nowrap right">Î¤Î¹Î¼Î® ÎœÎ¿Î½. (â‚¬)</th>
                  <th class="nowrap right">Î“ÏÎ±Î¼Î¼Î® (â‚¬)</th>
                  <th>Î•Î½Î­ÏÎ³ÎµÎ¹Î±</th>
                </tr>
              </thead>
              <tbody></tbody>
              <tfoot>
                <tr>
                  <td colspan="5" class="right sum">Î£ÏÎ½Î¿Î»Î¿ Î¥Î»Î¹ÎºÏÎ½ (â‚¬)</td>
                  <td class="right"><span id="materialsSum">0.00</span></td>
                  <td></td>
                </tr>
              </tfoot>
            </table>
          </div>
          <div class="btns" style="margin-top:8px;">
            <button id="addMat" class="ghost">â• Î“ÏÎ±Î¼Î¼Î® Ï…Î»Î¹ÎºÎ¿Ï</button>
            <button id="clearMat" class="ghost">ğŸ§¹ ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Ï…Î»Î¹ÎºÏÎ½</button>
          </div>
        </div>

        <!-- ÎšÏŒÏƒÏ„Î· & Î¦Î Î‘ -->
        <div style="grid-column: span 3;">
          <label>ÎšÏŒÏƒÏ„Î¿Ï‚ Î•ÏÎ³Î±ÏƒÎ¯Î±Ï‚ (â‚¬)</label>
          <input type="number" id="labor" step="0.01" min="0" placeholder="0.00" />
        </div>
        <div style="grid-column: span 3;">
          <label>Î£Ï…Î½Ï„ÎµÎ»ÎµÏƒÏ„Î®Ï‚ Î¦Î Î‘ (%)</label>
          <input type="number" id="vatRate" step="0.5" min="0" placeholder="24" />
        </div>
        <div style="grid-column: span 3;">
          <label>Î¥Ï€Î¿ÏƒÏÎ½Î¿Î»Î¿ (â‚¬) (Î•ÏÎ³Î±ÏƒÎ¯Î±+Î¥Î»Î¹ÎºÎ¬)</label>
          <input type="number" id="subtotal" step="0.01" readonly />
        </div>
        <div style="grid-column: span 3;">
          <label>Î¦Î Î‘ (â‚¬)</label>
          <input type="number" id="vatAmount" step="0.01" readonly />
        </div>
        <div style="grid-column: span 3;">
          <label>Î£ÏÎ½Î¿Î»Î¿ (â‚¬) Î¼Îµ Î¦Î Î‘</label>
          <input type="number" id="grandTotal" step="0.01" readonly />
        </div>
        <div style="grid-column: span 3;">
          <label>Î‘Ï. Î Î±ÏÎ±ÏƒÏ„Î±Ï„Î¹ÎºÎ¿Ï (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)</label>
          <input type="text" id="invoice" placeholder="Ï€.Ï‡. Î¤Î Î¥-123" />
        </div>
      </div>

      <div class="btns">
        <button class="primary" id="addBtn">â• Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ·</button>
        <button id="updateBtn" style="display:none">ğŸ’¾ Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ·</button>
        <button class="ghost" id="clearFormBtn">ğŸ§¹ Î•ÎºÎºÎ±Î¸Î¬ÏÎ¹ÏƒÎ· Ï†ÏŒÏÎ¼Î±Ï‚</button>
        <button id="installBtn" class="ok" style="display:none">ğŸ“² Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</button>
        <span class="pill" id="status">ÎˆÏ„Î¿Î¹Î¼Î¿</span>
      </div>
    </section>

    <!-- Î›Î¯ÏƒÏ„Î± ÎµÎ³Î³ÏÎ±Ï†ÏÎ½, Ï†Î¯Î»Ï„ÏÎ±, ÎµÎ¾Î±Î³Ï‰Î³Î­Ï‚ -->
    <section class="card" style="margin-top: 12px;">
      <div class="row">
        <div style="grid-column: span 3;">
          <label>Î‘Ï€ÏŒ</label>
          <input type="date" id="filterFrom" />
        </div>
        <div style="grid-column: span 3;">
          <label>ÎˆÏ‰Ï‚</label>
          <input type="date" id="filterTo" />
        </div>
        <div style="grid-column: span 3;">
          <label>Î ÎµÎ»Î¬Ï„Î·Ï‚ (Ï†Î¯Î»Ï„ÏÎ¿)</label>
          <input type="text" id="filterClient" placeholder="Ï€.Ï‡. Î“Î¹Î¬Î½Î½Î·Ï‚" />
        </div>
        <div style="grid-column: span 3;">
          <label>ÎšÎµÎ¯Î¼ÎµÎ½Î¿ (Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±/ÎµÏÎ³Î±ÏƒÎ¯ÎµÏ‚)</label>
          <input type="text" id="filterText" placeholder="Î»Î­Î¾Î·-ÎºÎ»ÎµÎ¹Î´Î¯" />
        </div>
      </div>
      <div class="btns">
        <button id="applyFilters">ğŸ” Î•Ï†Î±ÏÎ¼Î¿Î³Î® Ï†Î¯Î»Ï„ÏÏ‰Î½</button>
        <button id="resetFilters" class="ghost">â™»ï¸ ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Ï†Î¯Î»Ï„ÏÏ‰Î½</button>
        <button id="exportCsv" class="ok">â¬‡ï¸ Î•Î¾Î±Î³Ï‰Î³Î® CSV</button>
        <button id="printList" class="warn">ğŸ–¨ï¸ Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ·</button>
        <button id="backupJson" class="ghost">ğŸ’¾ Î‘Î½Ï„Î¯Î³ÏÎ±Ï†Î¿ (JSON)</button>
        <label class="pill" style="cursor:pointer">ğŸ“¤ Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® JSON
          <input id="restoreJson" type="file" accept="application/json" style="display:none" />
        </label>
        <span class="pill">Î£ÏÎ½Î¿Î»Î¿ ÎµÎ³Î³ÏÎ±Ï†ÏÎ½: <span id="count">0</span> â€¢ Î£ÏÎ½Î¿Î»Î¿ â‚¬: <span id="sum">0.00</span></span>
      </div>

      <div style="overflow:auto; max-height: 50vh; margin-top: 8px; border:1px solid var(--border); border-radius: 12px;">
        <table id="table">
          <thead>
            <tr>
              <th>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</th>
              <th>ÎÏÎµÏ‚</th>
              <th>Î ÎµÎ»Î¬Ï„Î·Ï‚</th>
              <th>Î¤Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±</th>
              <th>Î•ÏÎ³Î±ÏƒÎ¯ÎµÏ‚</th>
              <th>Î•ÏÎ³Î±ÏƒÎ¯Î± (â‚¬)</th>
              <th>Î¥Î»Î¹ÎºÎ¬ (â‚¬)</th>
              <th>Î¥Ï€Î¿ÏƒÏÎ½Î¿Î»Î¿ (â‚¬)</th>
              <th>Î¦Î Î‘ (%)</th>
              <th>Î¦Î Î‘ (â‚¬)</th>
              <th>Î£ÏÎ½Î¿Î»Î¿ (â‚¬)</th>
              <th>Î Î±ÏÎ±ÏƒÏ„.</th>
              <th>Î•Î½Î­ÏÎ³ÎµÎ¹ÎµÏ‚</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <div class="footer">Î”ÎµÎ´Î¿Î¼Î­Î½Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ Ï„Î¿Ï€Î¹ÎºÎ¬ (localStorage). Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÏ„Î±Î¹ offline Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î¼Î­ÏƒÏ‰ service worker. Î“Î¹Î± Ï€Î»Î®ÏÎµÏ‚ PWA/ÎµÎ¹ÎºÎ¿Î½Î¯Î´Î¹Î¿, Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Î±Ï…Ï„ÏŒ ÎºÎ±Î¹ Î¬Î½Î¿Î¹Î¾Î­ Ï„Î¿ Î±Ï€ÏŒ Î­Î½Î±Î½ Î¼Î¹ÎºÏÏŒ Ï„Î¿Ï€Î¹ÎºÏŒ server (Ï€.Ï‡. <code>npx serve</code>).</div>
    <section class="container card" style="margin-top:12px;">
    <h3 style="margin:0 0 8px 0;">âš™ï¸ PWA ÎŸÎ´Î·Î³ÏŒÏ‚ & Î‘ÏÏ‡ÎµÎ¯Î±</h3>
    <p class="sub">ÎšÎ±Ï„Î­Î²Î±ÏƒÎµ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± <strong>manifest</strong> & <strong>ÎµÎ¹ÎºÎ¿Î½Î¯Î´Î¹Î±</strong> ÎºÎ±Î¹ Î²Î¬Î»Îµ Ï„Î± ÏƒÏ„Î¿Î½ Î¯Î´Î¹Î¿ Ï†Î¬ÎºÎµÎ»Î¿ Î¼Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Î±Ï…Ï„ÏŒ (<code>index.html</code>). ÎˆÏ€ÎµÎ¹Ï„Î± Î¬Î½Î¿Î¹Î¾Î­ Ï„Î¿ Î¼Î­ÏƒÏ‰ https Î® <code>localhost</code>.</p>
    <div class="btns">
      <button id="dlManifest" class="ok">ğŸ“„ ÎšÎ±Ï„Î­Î²Î±ÏƒÎµ <code>manifest.webmanifest</code></button>
      <button id="dlIcon192" class="ghost">ğŸ–¼ï¸ ÎšÎ±Ï„Î­Î²Î±ÏƒÎµ <code>icon-192.png</code></button>
      <button id="dlIcon512" class="ghost">ğŸ–¼ï¸ ÎšÎ±Ï„Î­Î²Î±ÏƒÎµ <code>icon-512.png</code></button>
      <button id="pwaGuide" class="warn">ğŸ“˜ 3 Î’Î®Î¼Î±Ï„Î± Hosting</button>
    </div>
    <ol style="margin-top:8px;">
      <li><strong>Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î±ÏÏ‡ÎµÎ¯Ï‰Î½:</strong> ÎšÎ±Ï„Î­Î²Î±ÏƒÎµ Ï„Î± Ï„ÏÎ¯Î± Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Î¹ Î²Î¬Î»Îµ Ï„Î± Î´Î¯Ï€Î»Î± ÏƒÏ„Î¿ <code>index.html</code>.</li>
      <li><strong>Î¤Î¿Ï€Î¹ÎºÏŒÏ‚ server:</strong> Î†Î½Î¿Î¹Î¾Îµ Ï„ÎµÏÎ¼Î±Ï„Î¹ÎºÏŒ ÏƒÏ„Î¿Î½ Ï†Î¬ÎºÎµÎ»Î¿ ÎºÎ±Î¹ Ï„ÏÎ­Î¾Îµ <code>npx serve</code> Î® <code>python -m http.server 5173</code> ÎºÎ±Î¹ Î¼Ï€ÎµÏ‚ ÏƒÏ„Î¿ <code>http://localhost:5173</code> (Î® Ï„Î·Î½ Ï€ÏŒÏÏ„Î± Ï€Î¿Ï… Î¸Î± Î´ÎµÎ¯Î¾ÎµÎ¹).</li>
      <li><strong>Online (HTTPS):</strong> Î‘Î½Î­Î²Î±ÏƒÎµ Ï„Î± 4 Î±ÏÏ‡ÎµÎ¯Î± (index.html, manifest.webmanifest, icon-192.png, icon-512.png) ÏƒÎµ Netlify/Vercel/GitHub Pages/Cloudflare Pages. ÎœÎµÏ„Î¬ Î¬Î½Î¿Î¹Î¾Î­ Ï„Î¿ site ÎºÎ±Î¹ Ï€Î¬Ï„Î± Â«Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Â».</li>
    </ol>
  </section>

  </main>

  <script>
    const $$ = sel => document.querySelector(sel);
    const $$$ = sel => Array.from(document.querySelectorAll(sel));

    const fields = { date: $$('#date'), hours: $$('#hours'), client: $$('#client'), location: $$('#location'), task: $$('#task'), labor: $$('#labor'), vatRate: $$('#vatRate'), subtotal: $$('#subtotal'), vatAmount: $$('#vatAmount'), grandTotal: $$('#grandTotal'), invoice: $$('#invoice') };

    const statusEl = $$('#status');
    const tbody = document.querySelector('#table tbody');
    const materialsTBody = document.querySelector('#materialsTable tbody');
    const materialsSumEl = $$('#materialsSum');
    const countEl = $$('#count');
    const sumEl = $$('#sum');
    const STORAGE_KEY = 'jobs_v2';

    let data = load();
    let editingIndex = null;

    // Defaults
    fields.date.valueAsDate = new Date();
    fields.vatRate.value = localStorage.getItem('vat_default') || 24;

    function load(){ try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); } catch { return []; } }
    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }

    function toNumber(v){ const n = parseFloat(v); return isNaN(n) ? 0 : n; }
    function money(v){ return (toNumber(v)).toFixed(2); }

    // ===== Î¥Î›Î™ÎšÎ‘ =====
    function addMaterialRow(row){
      const tr = document.createElement('tr');
      const idx = materialsTBody.children.length + 1;
      tr.innerHTML = `
        <td class="nowrap">${idx}</td>
        <td><input placeholder="Ï€.Ï‡. ÎšÎ±Î»ÏÎ´Î¹Î¿ 3x2.5" class="mat-desc"/></td>
        <td style="width:110px"><input type="number" min="0" step="0.01" class="mat-qty" value="1"/></td>
        <td style="width:120px"><input placeholder="Ï€.Ï‡. m, Ï„Î¼Ï‡" class="mat-unit"/></td>
        <td style="width:140px"><input type="number" min="0" step="0.01" class="mat-price right" value="0"/></td>
        <td class="right line-total">0.00</td>
        <td><button class="ghost del-row">ğŸ—‘ï¸</button></td>`;
      materialsTBody.appendChild(tr);
      if(row){ tr.querySelector('.mat-desc').value = row.desc || ''; tr.querySelector('.mat-qty').value = row.qty || 1; tr.querySelector('.mat-unit').value = row.unit || ''; tr.querySelector('.mat-price').value = row.price || 0; }
      bindMatRow(tr);
      recalcMaterials();
    }

    function bindMatRow(tr){
      tr.querySelectorAll('input').forEach(inp => inp.addEventListener('input', recalcMaterials));
      tr.querySelector('.del-row').addEventListener('click', ()=> { tr.remove(); recalcMaterials(); });
    }

    function getMaterials(){
      return $$$('#materialsTable tbody tr').map(tr => ({
        desc: tr.querySelector('.mat-desc').value.trim(),
        qty: toNumber(tr.querySelector('.mat-qty').value),
        unit: tr.querySelector('.mat-unit').value.trim(),
        price: toNumber(tr.querySelector('.mat-price').value),
      })).filter(r => r.desc || r.qty || r.price);
    }

    function recalcMaterials(){
      let sum = 0;
      $$$('#materialsTable tbody tr').forEach(tr => {
        const qty = toNumber(tr.querySelector('.mat-qty').value);
        const price = toNumber(tr.querySelector('.mat-price').value);
        const line = qty * price;
        tr.querySelector('.line-total').textContent = money(line);
        sum += line;
      });
      materialsSumEl.textContent = money(sum);
      recalcTotals();
    }

    // ===== Î£Î¥ÎÎŸÎ›Î‘ & Î¦Î Î‘ =====
    function recalcTotals(){
      const labor = toNumber(fields.labor.value);
      const mats = toNumber(materialsSumEl.textContent);
      const subtotal = labor + mats;
      const vatRate = Math.max(0, toNumber(fields.vatRate.value));
      const vatAmount = subtotal * vatRate / 100;
      const grand = subtotal + vatAmount;
      fields.subtotal.value = money(subtotal);
      fields.vatAmount.value = money(vatAmount);
      fields.grandTotal.value = money(grand);
      localStorage.setItem('vat_default', String(vatRate));
    }

    ['labor','vatRate'].forEach(id => $(`#${id}`).addEventListener('input', ()=>{ recalcMaterials(); recalcTotals(); }));

    // ===== CRUD =====
    function status(msg){ statusEl.textContent = msg; statusEl.style.borderColor = 'var(--border)'; }

    function clearForm(){
      fields.hours.value = '';
      fields.client.value = '';
      fields.location.value = '';
      fields.task.value = '';
      fields.labor.value = '';
      fields.subtotal.value = '';
      fields.vatAmount.value = '';
      fields.grandTotal.value = '';
      fields.invoice.value = '';
      materialsTBody.innerHTML = '';
      addMaterialRow();
      editingIndex = null;
      $$('#addBtn').style.display = '';
      $$('#updateBtn').style.display = 'none';
      status('ÎˆÏ„Î¿Î¹Î¼Î¿');
    }

    function collect(){
      const mats = getMaterials();
      const materialsSum = mats.reduce((s,r)=> s + r.qty*r.price, 0);
      const subtotal = toNumber(fields.labor.value) + materialsSum;
      const vatRate = Math.max(0, toNumber(fields.vatRate.value));
      const vatAmount = subtotal * vatRate / 100;
      return {
        id: crypto.randomUUID(),
        date: fields.date.value || new Date().toISOString().slice(0,10),
        hours: money(fields.hours.value),
        client: fields.client.value.trim(),
        location: fields.location.value.trim(),
        task: fields.task.value.trim(),
        materials: mats,
        materialsSum: money(materialsSum),
        labor: money(fields.labor.value),
        subtotal: money(subtotal),
        vatRate: vatRate,
        vatAmount: money(vatAmount),
        total: money(subtotal + vatAmount),
        invoice: fields.invoice.value.trim()
      };
    }

    function validate(rec){ if(!rec.client) return 'Î£Ï…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ Ï„Î¿Î½ Ï€ÎµÎ»Î¬Ï„Î·'; if(!rec.task) return 'Î£Ï…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ Ï„Î¹Ï‚ ÎµÏÎ³Î±ÏƒÎ¯ÎµÏ‚'; return null; }

    function add(){
      const rec = collect();
      const err = validate(rec); if(err){ alert(err); return; }
      data.push(rec); save(); status('Î ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ âœ…'); render(); clearForm();
    }

    function startEdit(id){
      const idx = data.findIndex(r => r.id === id); if(idx===-1) return; const r = data[idx]; editingIndex = idx;
      fields.date.value = r.date; fields.hours.value = r.hours; fields.client.value = r.client; fields.location.value = r.location; fields.task.value = r.task; fields.labor.value = r.labor; fields.vatRate.value = r.vatRate ?? (localStorage.getItem('vat_default')||24); fields.subtotal.value = r.subtotal; fields.vatAmount.value = r.vatAmount; fields.grandTotal.value = r.total; fields.invoice.value = r.invoice || '';
      materialsTBody.innerHTML=''; (r.materials||[]).forEach(addMaterialRow); if((r.materials||[]).length===0) addMaterialRow();
      $$('#addBtn').style.display = 'none'; $$('#updateBtn').style.display = '';
      status('Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚â€¦'); window.scrollTo({top:0, behavior:'smooth'});
      recalcMaterials();
    }

    function update(){ if(editingIndex===null) return; const rec = collect(); rec.id = data[editingIndex].id; const err = validate(rec); if(err){ alert(err); return; } data[editingIndex] = rec; save(); status('Î•Î½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎµ ğŸ’¾'); render(); clearForm(); }

    function remove(id){ if(!confirm('Î”Î¹Î±Î³ÏÎ±Ï†Î® ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚;')) return; data = data.filter(r => r.id !== id); save(); render(); status('Î”Î¹Î±Î³ÏÎ¬Ï†Î·ÎºÎµ ğŸ—‘ï¸'); }

    // ===== Î¦Î™Î›Î¤Î¡Î‘/Î Î™ÎÎ‘ÎšÎ‘Î£ =====
    function filtered(){
      const fFrom = $$('#filterFrom').value; const fTo = $$('#filterTo').value; const fClient = ($$('#filterClient').value||'').trim().toLowerCase(); const fText = ($$('#filterText').value||'').trim().toLowerCase();
      return data.filter(r => {
        if(fFrom && r.date < fFrom) return false; if(fTo && r.date > fTo) return false; if(fClient && !r.client.toLowerCase().includes(fClient)) return false; if(fText && !(r.location+" "+r.task).toLowerCase().includes(fText)) return false; return true;
      }).sort((a,b)=> (a.date===b.date?0:(a.date>b.date?1:-1)));
    }

    function addRow(rec){
      const tr = document.createElement('tr');
      const cells = [rec.date, rec.hours, rec.client, rec.location, rec.task, money(rec.labor), money(rec.materialsSum), money(rec.subtotal), rec.vatRate+'%', money(rec.vatAmount), money(rec.total), rec.invoice || 'â€”'];
      cells.forEach(c => { const td = document.createElement('td'); td.textContent = c; tr.appendChild(td); });
      const tdAct = document.createElement('td'); const e = document.createElement('button'); e.textContent = 'âœï¸'; e.className='ghost'; const d = document.createElement('button'); d.textContent='ğŸ—‘ï¸'; d.className='ghost'; tdAct.append(e,' ',d); tr.appendChild(tdAct);
      e.addEventListener('click', () => startEdit(rec.id)); d.addEventListener('click', ()=> remove(rec.id)); tbody.appendChild(tr);
    }

    function render(){ tbody.innerHTML=''; const items = filtered(); items.forEach(addRow); countEl.textContent = items.length; const sum = items.reduce((s,r)=> s + toNumber(r.total), 0); sumEl.textContent = sum.toFixed(2); }

    function applyFilters(){ render(); status('Î•Ï†Î±ÏÎ¼ÏŒÏƒÏ„Î·ÎºÎ±Î½ Ï†Î¯Î»Ï„ÏÎ±'); }
    function resetFilters(){ ['#filterFrom','#filterTo','#filterClient','#filterText'].forEach(s=> $$(s).value=''); render(); status('ÎšÎ±Î¸Î±ÏÎ¯ÏƒÏ„Î·ÎºÎ±Î½ Ï†Î¯Î»Ï„ÏÎ±'); }

    // ===== Î•ÎÎ‘Î“Î©Î“Î•Î£ =====
    function downloadFile(filename, mime, content){ const blob = new Blob([content], {type: mime}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = filename; a.click(); setTimeout(()=> URL.revokeObjectURL(url), 0); }

    function exportCsv(){
      const rows = [[ 'Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±','ÎÏÎµÏ‚','Î ÎµÎ»Î¬Ï„Î·Ï‚','Î¤Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±','Î•ÏÎ³Î±ÏƒÎ¯ÎµÏ‚','Î•ÏÎ³Î±ÏƒÎ¯Î± (â‚¬)','Î¥Î»Î¹ÎºÎ¬ (â‚¬)','Î¥Ï€Î¿ÏƒÏÎ½Î¿Î»Î¿ (â‚¬)','Î¦Î Î‘ (%)','Î¦Î Î‘ (â‚¬)','Î£ÏÎ½Î¿Î»Î¿ (â‚¬)','Î Î±ÏÎ±ÏƒÏ„Î±Ï„Î¹ÎºÏŒ','Î¥Î»Î¹ÎºÎ¬ (Î±Î½Î±Î»Ï…Ï„Î¹ÎºÎ¬)']];
      filtered().forEach(r=>{
        const mats = (r.materials||[]).map(m=> `${m.desc} x${m.qty} ${m.unit} @${money(m.price)}â‚¬ = ${money(m.qty*m.price)}â‚¬`).join(' | ');
        rows.push([r.date,r.hours,r.client,r.location,r.task,r.labor,r.materialsSum,r.subtotal,r.vatRate,r.vatAmount,r.total,r.invoice||'', mats]);
      });
      const csv = rows.map(row=> row.map(cell => '"'+String(cell).replaceAll('"','""')+'"').join(',')).join('
');
      downloadFile('Î´Î¿Ï…Î»ÎµÎ¹Î­Ï‚.csv','text/csv;charset=utf-8;',csv); status('Î•Î¾Î®Ï‡Î¸Î· CSV â¬‡ï¸');
    }

    function backupJson(){ downloadFile('jobs-backup.json','application/json', JSON.stringify(data,null,2)); status('Î‘Î½Ï„Î¯Î³ÏÎ±Ï†Î¿ Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ ğŸ’¾'); }

    function restoreJson(ev){ const file = ev.target.files?.[0]; if(!file) return; const reader = new FileReader(); reader.onload = () => { try { const arr = JSON.parse(reader.result); if(!Array.isArray(arr)) throw new Error('bad'); data = arr; save(); render(); status('Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ âœ…'); } catch(e){ alert('ÎœÎ· Î­Î³ÎºÏ…ÏÎ¿ Î±ÏÏ‡ÎµÎ¯Î¿ JSON'); } }; reader.readAsText(file); ev.target.value=''; }

    function printList(){
      const w = window.open('', '_blank'); const rows = filtered(); const style = `body{font-family:system-ui,Segoe UI,Arial; padding:24px;} table{width:100%; border-collapse:collapse;} th,td{border:1px solid #ddd; padding:6px 8px; font-size:12px;} th{background:#f3f4f6;}`;
      w.document.write('<html><head><title>Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ·</title><style>'+style+'</style></head><body>');
      w.document.write('<h2>Î›Î¯ÏƒÏ„Î± Î”Î¿Ï…Î»ÎµÎ¹ÏÎ½</h2>');
      w.document.write('<table><thead><tr><th>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</th><th>ÎÏÎµÏ‚</th><th>Î ÎµÎ»Î¬Ï„Î·Ï‚</th><th>Î¤Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±</th><th>Î•ÏÎ³Î±ÏƒÎ¯ÎµÏ‚</th><th>Î•ÏÎ³Î±ÏƒÎ¯Î± (â‚¬)</th><th>Î¥Î»Î¹ÎºÎ¬ (â‚¬)</th><th>Î¥Ï€Î¿ÏƒÏÎ½Î¿Î»Î¿</th><th>Î¦Î Î‘</th><th>Î£ÏÎ½Î¿Î»Î¿</th><th>Î Î±ÏÎ±ÏƒÏ„.</th></tr></thead><tbody>');
      rows.forEach(r=>{ w.document.write(`<tr><td>${r.date}</td><td>${r.hours}</td><td>${esc(r.client)}</td><td>${esc(r.location)}</td><td>${esc(r.task)}</td><td>${r.labor}</td><td>${r.materialsSum}</td><td>${r.subtotal}</td><td>${r.vatRate}% (${r.vatAmount}â‚¬)</td><td>${r.total}</td><td>${esc(r.invoice||'')}</td></tr>`); });
      const sum = rows.reduce((s,r)=> s + (parseFloat(r.total)||0), 0).toFixed(2); w.document.write(`<tfoot><tr><td colspan="9" style="text-align:right"><strong>Î£ÏÎ½Î¿Î»Î¿ (â‚¬):</strong></td><td colspan="2"><strong>${sum}</strong></td></tr></tfoot>`);
      w.document.write('</tbody></table>'); w.document.write('</body></html>'); w.document.close(); w.focus(); w.print();
    }

    function esc(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    // Events
    $$('#addMat').addEventListener('click', ()=> addMaterialRow());
    $$('#clearMat').addEventListener('click', ()=> { if(confirm('ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Ï…Î»Î¹ÎºÏÎ½;')){ materialsTBody.innerHTML=''; addMaterialRow(); recalcMaterials(); }});
    $$('#addBtn').addEventListener('click', add);
    $$('#updateBtn').addEventListener('click', update);
    $$('#clearFormBtn').addEventListener('click', clearForm);
    $$('#applyFilters').addEventListener('click', applyFilters);
    $$('#resetFilters').addEventListener('click', resetFilters);
    $$('#exportCsv').addEventListener('click', exportCsv);
    $$('#printList').addEventListener('click', printList);
    $$('#backupJson').addEventListener('click', backupJson);
    $$('#restoreJson').addEventListener('change', restoreJson);

    // Init materials with one line
    addMaterialRow();

    // Initial list
    render();

    // ===== PWA SETUP (Ï€Î»Î®ÏÎµÏ‚, Î¼Îµ manifest & icons) =====
    // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î´Ï…Î½Î±Î¼Î¹ÎºÎ¿Ï manifest Î³Î¹Î± Î´Î¿ÎºÎ¹Î¼Î®/Ï„Î¿Ï€Î¹ÎºÎ® Ï‡ÏÎ®ÏƒÎ·
    function buildManifest(){
      const manifest = {
        name: "ÎšÎ±Ï„Î±Î³ÏÎ±Ï†Î® Î”Î¿Ï…Î»ÎµÎ¹ÏÎ½",
        short_name: "Î”Î¿Ï…Î»ÎµÎ¹Î­Ï‚",
        description: "ÎšÎ±Ï„Î±Ï‡ÏÏÎ¹ÏƒÎ· ÎµÏÎ³Î±ÏƒÎ¹ÏÎ½ Î¼Îµ Ï…Î»Î¹ÎºÎ¬ & Î¦Î Î‘, offline.",
        start_url: ".",
        display: "standalone",
        background_color: "#0f172a",
        theme_color: "#22d3ee",
        icons: [
          { src: "icon-192.png", sizes: "192x192", type: "image/png" },
          { src: "icon-512.png", sizes: "512x512", type: "image/png" }
        ]
      };
      return new Blob([JSON.stringify(manifest, null, 2)], { type: 'application/manifest+json' });
    }

    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· <link rel="manifest"> Î³Î¹Î± Î¬Î¼ÎµÏƒÎ· Î´Î¿ÎºÎ¹Î¼Î®
    try {
      const mfBlobUrl = URL.createObjectURL(buildManifest());
      const link = document.createElement('link');
      link.rel = 'manifest';
      link.href = mfBlobUrl;
      document.head.appendChild(link);
      const meta = document.createElement('meta'); meta.name = 'theme-color'; meta.content = '#22d3ee'; document.head.appendChild(meta);
    } catch(e) { console.warn('Manifest inject failed', e); }

    // Service Worker (offline cache)
    const swCode = `self.addEventListener('install', e=>{ self.skipWaiting(); e.waitUntil(caches.open('jobs-cache-v2').then(c=> c.addAll(['./'])));}); self.addEventListener('activate', e=> self.clients.claim()); self.addEventListener('fetch', e=>{ e.respondWith(caches.match(e.request).then(r=> r || fetch(e.request).then(resp=>{ const copy = resp.clone(); caches.open('jobs-cache-v2').then(c=> c.put(e.request, copy)); return resp; } ).catch(()=> r))); });`;
    try {
      const blob = new Blob([swCode], {type:'text/javascript'});
      const swUrl = URL.createObjectURL(blob);
      if('serviceWorker' in navigator){ navigator.serviceWorker.register(swUrl); }
    } catch(err){ console.warn('SW register failed', err); }

    // Î•Î¹ÎºÎ¿Î½Î¯Î´Î¹Î±: ÏƒÏ‡ÎµÎ´Î¯Î±ÏƒÎ· PNG 192/512 Î¼Î­ÏƒÏ‰ canvas ÎºÎ±Î¹ Î»Î®ÏˆÎ· Î±ÏÏ‡ÎµÎ¯Ï‰Î½
    function drawIcon(size){
      const c = document.createElement('canvas'); c.width = c.height = size; const ctx = c.getContext('2d');
      // background circle
      ctx.fillStyle = '#0f172a'; ctx.fillRect(0,0,size,size);
      ctx.beginPath(); ctx.arc(size/2, size/2, size*0.46, 0, Math.PI*2); ctx.fillStyle = '#111827'; ctx.fill();
      // cyan ring
      ctx.lineWidth = size*0.06; ctx.strokeStyle = '#22d3ee'; ctx.beginPath(); ctx.arc(size/2, size/2, size*0.38, 0, Math.PI*2); ctx.stroke();
      // bolt
      ctx.fillStyle = '#a78bfa';
      ctx.beginPath();
      const w = size*0.16, h = size*0.34; const x = size/2 - w/2, y = size/2 - h/2;
      ctx.moveTo(x, y); ctx.lineTo(x+w*0.55, y); ctx.lineTo(x+w*0.25, y+h*0.55); ctx.lineTo(x+w, y+h*0.55); ctx.lineTo(x+w*0.45, y+h); ctx.lineTo(x+w*0.7, y+h*0.45); ctx.lineTo(x, y+h*0.45); ctx.closePath();
      ctx.fill();
      // label
      ctx.fillStyle = '#e5e7eb'; ctx.font = `${Math.floor(size*0.14)}px system-ui,Segoe UI,Arial`; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText('Î”', size/2, size*0.78);
      return c.toDataURL('image/png');
    }

    function downloadDataUrl(name, url){ const a=document.createElement('a'); a.href=url; a.download=name; a.click(); }

    $$('#dlIcon192').addEventListener('click', ()=> downloadDataUrl('icon-192.png', drawIcon(192)));
    $$('#dlIcon512').addEventListener('click', ()=> downloadDataUrl('icon-512.png', drawIcon(512)));

    $$('#dlManifest').addEventListener('click', ()=> {
      const b = buildManifest(); const url = URL.createObjectURL(b); const a = document.createElement('a'); a.href = url; a.download = 'manifest.webmanifest'; a.click(); setTimeout(()=> URL.revokeObjectURL(url), 0);
    });

    $$('#pwaGuide').addEventListener('click', ()=>{
      alert(`3 Î’Î®Î¼Î±Ï„Î± Hosting:

1) Î’Î¬Î»Îµ ÏƒÏ„Î¿Î½ Î¯Î´Î¹Î¿ Ï†Î¬ÎºÎµÎ»Î¿: index.html, manifest.webmanifest, icon-192.png, icon-512.png.
2) Î¤ÏÎ­Î¾Îµ Ï„Î¿Ï€Î¹ÎºÏŒ server: npx serve  Î®  python -m http.server 5173  ÎºÎ±Î¹ Î¬Î½Î¿Î¹Î¾Îµ Ï„Î¿ http://localhost:5173
3) Î“Î¹Î± Internet/HTTPS: Î‘Î½Î­Î²Î±ÏƒÎµ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± ÏƒÎµ Netlify/Vercel/GitHub Pages/Cloudflare Pages. ÎœÎµÏ„Î¬ Î¬Î½Î¿Î¹Î¾Îµ Ï„Î¿ site ÎºÎ±Î¹ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎµ Ï„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯ \"ğŸ“² Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·\".`);
    });

    // Install prompt button
    let deferredPrompt = null; const installBtn = $$('#installBtn');
    window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt = e; installBtn.style.display=''; });
    installBtn.addEventListener('click', async ()=> { if(!deferredPrompt) return; deferredPrompt.prompt(); const { outcome } = await deferredPrompt.userChoice; if(outcome==='accepted'){ installBtn.textContent='âœ… Î•Î³ÎºÎ±Ï„Î±ÏƒÏ„Î¬Î¸Î·ÎºÎµ'; } deferredPrompt=null; });
